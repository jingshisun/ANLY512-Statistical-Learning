---
title: "HW6Test"
author: "Jingshi"
date: "3/11/2017"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Best subset question

## a)

```{r}
library(leaps)
set.seed(107)
X = as.data.frame(matrix(rnorm(4200), ncol = 21)) 
names(X)[1] <- "y"
bestSubset <- regsubsets(y~., data = X, nvmax = 20)
mySummary<-summary(bestSubset)
par(mfrow = c(1, 3))
plot(mySummary$adjr2, xlab = "number of predictors", ylab = "Adjusted R^2", type = "o")
points(which.max(mySummary$adjr2), mySummary$adjr2[which.max(mySummary$adjr2)], col = "blue"
       , cex = 2, pch = 4)
plot(mySummary$cp, xlab = "number of predictors", ylab = "Cp", type = "o") 
points(which.min(mySummary$cp), mySummary$cp[which.min(mySummary$cp)], col = "blue",
cex = 2, pch = 4)
plot(mySummary$bic, xlab = "number of predictors", ylab = "BIC", type = "o") 
points(which.min(mySummary$bic), mySummary$bic[which.min(mySummary$bic)], col = "blue",
cex = 2, pch = 4)

```


As the plots shown, the best model size for adjusted $R^2$ criteria is 9 because adjusted $R^2$ is highest at model size 9.

The best model size for Mallows Cp is 4 because Mallows Cp is lowest at model size 4.

The best model size for Bayes Information Criterion is 1 because BIC is lowest at model size 1.

## b)


```{r}
library(boot)
#install.packages("gmp")
#install.packages("HH")
library(HH)
myDelta<-function(num_variables){
  model<-lm.regsubsets(bestSubset, num_variables)
  r1<-cv.glm(X, glm(model), K = 10)$delta[1]
  r2<-cv.glm(X, glm(model), K = 10)$delta[1]
  r3<-cv.glm(X, glm(model), K = 10)$delta[1]
  range(r1,r2,r3)
}

myDelta1<-function(num_variables){
  model<-lm.regsubsets(bestSubset, num_variables)
  cv.glm(X, glm(model), K = 10)$delta[1]

}

set.seed(11)
for(i in c(1:20)){
  cat ("Error for model size of",i,"is between",myDelta(i)[1],"and",myDelta(i)[2], "\n")
}


cv.errors <- matrix(NA, 3, 20) # 3 iterations = 3 rows;  20 variables = 20 columns
set.seed(11)
for(i in c(1:20)){
  cv.errors[1,i] = myDelta1(i)
  cv.errors[2,i] = myDelta1(i)
  cv.errors[3,i] = myDelta1(i)
}
plot (cv.errors[1,], pch=20, type="b", ylab = "MSE")
lines (cv.errors[2,], pch=20, type="b")
lines (cv.errors[3,], pch=20, type="b")

```


As the output shows, the model achives lowest MSE between 5 to 9. Models with size less than or equal to 9 has comparative lower MSE.


## c)

Compare all four approaches, I would choose 9 as the best model size since it has the highest adjusted $R^2$, comparatively low MSE, comparatively low Cp and comparatively low BIC. Thus, adjusted $R^2$ makes sense.

```{r}
cat ("The best model is:")
coef(bestSubset, 9)
```



